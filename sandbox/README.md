# Collecting logs

This is a very basic sandbox environment that can be used for creating simple scripts for automated malware analysis, it contains 3 parts

- vm-scripts
- client
- server

## vm-scripts
This contains a small script `vm.py` that is a wrapper around `vmrun` command provided by `vmware-workstation` ( `vmrun` should be present in `PATH` ). 
This can be used to create the snapshot and restore the state of the VM

```
Usage: vm.py [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  restore   will make a destroyable copy of VM
  snapshot  create the snapshot of VM
```

## server and client
In sandbox, there will be 2 server client instances, one is the basic `agent` that will be present inside the VM during the snapshot. 
The agent has a third optional argument which allows spawning a process with `monitoring.exe`, which can be used for getting logs for specific malware samples

### client
This should be kept in the host system, this will be used to send malware samples to the VM for analysis

```
Usage: client.py [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  send   send malware file for analysis
  watch  watch upload directory of agent for the logs
```
After the malware is sent for analysis, you can watch the upload directory using `watch` command which will wait for the logs to be downloaded back from the VM. 
This can be used for restoring the VM state for new malware sample analysis

You'll have to setup a `config.ini` in the same directory as the client which will have these info

```
[default]
api = <url to server inside guest sandbox>
upload_dir = <upload directory for agent>
```

### server
The server should be configured inside the VM before the snapshot, the server will keep listening for the malware samples. 
As soon as it gets a sample, it will spawn the agent and stop the server so that the server's networking connections don't interfere with the logs in malware sample

The server code is also accompanied by `config.ini` which should be configured as follows

```
[default]
script = <path to python script which runs monitoring.exe>
```
