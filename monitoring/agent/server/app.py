from pathlib import Path

from flask import Flask, request
from werkzeug.utils import secure_filename

app = Flask(__name__)


@app.route("/upload", methods=["POST"])
def upload_file():
    upload_dir = Path("upload")
    name = request.form["name"]
    timestamp = request.form["timestamp"]

    if name == str(None):
        folder = upload_dir / timestamp
    else:
        folder = upload_dir / name

    folder.mkdir(parents=True, exist_ok=True)
    folder = folder.absolute().resolve()

    f = request.files["file"]
    f.save(folder / secure_filename(f.filename))
    return "file uploaded successfully"


if __name__ == "__main__":
    app.run(debug=True, host='0.0.0.0')
